<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Horaires de priÃ¨re - Lille</title>
  <meta name="description" content="Horaires de priÃ¨re pour Lille, France." />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050816;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    main {
      background: #0b1020;
      padding: 1.5rem;
      border-radius: 1rem;
      width: min(480px, 100%);
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    }
    h1, h2 {
      margin: 0;
      margin-bottom: 0.4rem;
    }
    .location {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 0.4rem;
    }
    #status {
      margin-top: 0.6rem;
      font-size: 0.9rem;
      margin-bottom: 0.6rem;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0.8rem 0;
      border-top: 1px solid rgba(255,255,255,0.15);
    }
    li {
      display: flex;
      justify-content: space-between;
      padding: 0.35rem 0;
      font-size: 0.95rem;
    }
    .name {
      opacity: 0.9;
    }
    button {
      margin-top: 0.9rem;
      width: 100%;
      padding: 0.6rem;
      border-radius: 0.75rem;
      border: none;
      cursor: pointer;
      background: #1f2937;
      color: #f5f5f5;
      font-size: 0.95rem;
    }
    .duas {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    .dua {
      background: rgba(255,255,255,0.05);
      padding: 0.8rem;
      border-radius: 0.5rem;
      margin-bottom: 0.8rem;
    }
    .dua-title {
      margin: 0;
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
  </style>
</head>

<body>
  <main>
    <h1>Horaires de priÃ¨re</h1>
    <p style="opacity:0.7; font-size:0.85rem;">RÃ©alisÃ© par ton amoureux Anas â¤ï¸</p>

    <p class="location">Lille, France (mÃ©thode Muslim World League)</p>
    <p id="date"></p>
    <p id="status">Chargement des horaires...</p>

    <ul id="prayer-list" aria-live="polite"></ul>

    <button id="refresh">Actualiser les horaires</button>

    <!-- SECTION DOUAS -->
    <section class="duas">
      <h2>Douas importantes</h2>

      <div class="dua">
        <p class="dua-title">ğŸ”¸ Doua du matin</p>
        <p>â€œAllahoumma bika asbahna wa bika amsayna wa bika nahya wa bika namout wa ilayka an-nouchour.â€</p>
      </div>

      <div class="dua">
        <p class="dua-title">ğŸ”¸ Doua du soir</p>
        <p>â€œAllahoumma bika amsayna wa bika asbahna wa bika nahya wa bika namout wa ilayka al-massir.â€</p>
      </div>

      <div class="dua">
        <p class="dua-title">ğŸ”¸ Demande de pardon</p>
        <p>â€œAstaghfiroullah al-â€˜azim alladhi la ilaha illa Houwa al-Hayy al-Qayyoum wa atoubou ilayh.â€</p>
      </div>

      <div class="dua">
        <p class="dua-title">ğŸ”¸ Protection et tranquillitÃ©</p>
        <p>â€œHasbiyallahou la ilaha illa Houwa â€˜alayhi tawakkaltou wa Houwa Rabboul-â€˜Arshil-â€˜Azim.â€</p>
      </div>

      <div class="dua">
        <p class="dua-title">ğŸ”¸ Demande de guidance</p>
        <p>â€œRabbi zidni â€˜ilma. Ã” Allah, augmente-moi en science.â€</p>
      </div>

    </section>
  </main>

  <script>
    const CITY = "Lille";
    const COUNTRY = "France";
    const METHOD = 3;
    const SCHOOL = 0;

    const dateEl = document.getElementById("date");
    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("prayer-list");
    const refreshBtn = document.getElementById("refresh");

    function formatDateFr(d) {
      return d.toLocaleDateString("fr-FR", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      });
    }

    function formatTimeFr(d) {
      return d.toLocaleTimeString("fr-FR", {
        hour: "2-digit",
        minute: "2-digit",
      });
    }

    async function loadPrayerTimes() {
      const today = new Date();
      const day = today.getDate();
      const month = today.getMonth() + 1;
      const year = today.getFullYear();

      dateEl.textContent = "Nous sommes le " + formatDateFr(today) + ".";
      statusEl.textContent = "Chargement des horaires...";
      listEl.innerHTML = "";

      const url =
        "https://api.aladhan.com/v1/timingsByCity"
        + "?city=" + encodeURIComponent(CITY)
        + "&country=" + encodeURIComponent(COUNTRY)
        + "&method=" + METHOD
        + "&school=" + SCHOOL
        + "&day=" + day
        + "&month=" + month
        + "&year=" + year;

      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("HTTP " + res.status);

        const json = await res.json();
        if (!json || json.code !== 200) throw new Error("API error");

        const t = json.data.timings;

        const mapping = [
          ["Fajr", "Fajr"],
          ["Sunrise", "Lever du soleil"],
          ["Dhuhr", "Dhor"],
          ["Asr", "Asr"],
          ["Maghrib", "Maghrib"],
          ["Isha", "Isha"],
        ];

        listEl.innerHTML = "";
        mapping.forEach(([key, label]) => {
          const raw = t[key];
          if (!raw) return;

          const [h, m] = raw.split(":").map(Number);
          const d = new Date(year, month - 1, day, h, m);

          const li = document.createElement("li");
          li.innerHTML = `<span class="name">${label}</span><span>${formatTimeFr(d)}</span>`;
          listEl.appendChild(li);
        });

        statusEl.textContent = "Horaires chargÃ©s avec succÃ¨s.";
      } catch (err) {
        statusEl.textContent = "Erreur : impossible de charger les horaires.";
        console.error(err);
      }
    }

    document.addEventListener("DOMContentLoaded", loadPrayerTimes);
    refreshBtn.addEventListener("click", loadPrayerTimes);
  </script>
</body>
</html>
