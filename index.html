<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Horaires de prière - Lille</title>
  <meta name="description" content="Horaires de prière pour Lille, France." />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050816;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    main {
      background: #0b1020;
      padding: 1.5rem;
      border-radius: 1rem;
      width: min(420px, 95vw);
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.25rem;
    }
    p {
      margin: 0.3rem 0;
    }
    .location {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    #status {
      margin-top: 0.6rem;
      font-size: 0.9rem;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0.8rem 0 0;
      border-top: 1px solid rgba(255,255,255,0.15);
    }
    li {
      display: flex;
      justify-content: space-between;
      padding: 0.35rem 0;
      font-size: 0.95rem;
    }
    .name {
      opacity: 0.9;
    }
    button {
      margin-top: 0.9rem;
      width: 100%;
      padding: 0.6rem;
      border-radius: 0.75rem;
      border: none;
      cursor: pointer;
      background: #1f2937;
      color: #f5f5f5;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <main>
    <h1>Horaires de prière</h1>
    <p class="location">Lille, France (méthode Muslim World League)</p>
    <p id="date"></p>
    <p id="status">Chargement des horaires...</p>
    <ul id="prayer-list" aria-live="polite"></ul>
    <button id="refresh">Actualiser les horaires</button>
  </main>

  <script>
    const CITY = "Lille";
    const COUNTRY = "France";
    const METHOD = 3;  // Muslim World League
    const SCHOOL = 0;  // Standard

    const dateEl = document.getElementById("date");
    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("prayer-list");
    const refreshBtn = document.getElementById("refresh");

    function formatDateFr(d) {
      return d.toLocaleDateString("fr-FR", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      });
    }

    function formatTimeFr(d) {
      return d.toLocaleTimeString("fr-FR", {
        hour: "2-digit",
        minute: "2-digit",
      });
    }

    async function loadPrayerTimes() {
      const today = new Date();
      const day = today.getDate();
      const month = today.getMonth() + 1;
      const year = today.getFullYear();

      dateEl.textContent = "Nous sommes le " + formatDateFr(today) + ".";
      statusEl.textContent = "Chargement des horaires...";
      listEl.innerHTML = "";

      const url =
        "https://api.aladhan.com/v1/timingsByCity"
        + "?city=" + encodeURIComponent(CITY)
        + "&country=" + encodeURIComponent(COUNTRY)
        + "&method=" + METHOD
        + "&school=" + SCHOOL
        + "&day=" + day
        + "&month=" + month
        + "&year=" + year;

      console.log("Appel API :", url);

      try {
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }
        const json = await res.json();
        console.log("Réponse API :", json);

        if (!json || json.code !== 200 || !json.data || !json.data.timings) {
          throw new Error("Format de réponse inattendu");
        }

        const t = json.data.timings;
        const mapping = [
          ["Fajr", "Fajr"],
          ["Sunrise", "Lever du soleil"],
          ["Dhuhr", "Dhor"],
          ["Asr", "Asr"],
          ["Maghrib", "Maghrib"],
          ["Isha", "Isha"],
        ];

        const now = new Date();
        listEl.innerHTML = "";
        mapping.forEach(([key, label]) => {
          const raw = t[key];
          if (!raw) return;
          const [h, m] = raw.split(":").map(Number);
          const d = new Date(year, month - 1, day, h, m, 0, 0);

          const li = document.createElement("li");
          const spanName = document.createElement("span");
          const spanTime = document.createElement("span");
          spanName.className = "name";
          spanName.textContent = label;
          spanTime.textContent = formatTimeFr(d);
          li.appendChild(spanName);
          li.appendChild(spanTime);
          listEl.appendChild(li);
        });

        statusEl.textContent = "Horaires chargés avec succès.";
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "Impossible de charger les horaires. Vérifie ta connexion ou réessaie plus tard.";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadPrayerTimes();
      refreshBtn.addEventListener("click", loadPrayerTimes);
    });
  </script>
</body>
</html>
